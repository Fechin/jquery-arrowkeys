!function(a){"use strict";var b="function"==typeof define&&define.amd,c="undefined"!=typeof module&&module.exports;b?define(["jquery"],a):c?module.exports=a(require("jquery")):a(window.jQuery)}(function(a){var b=function(a,b){this.opts=b,this.cards=a,this.cardMap={};for(var c=0,d=a.length;d>c;c++)for(var e=a.eq(c).attr("class").split(" "),f=0,g=e.length;g>f;f++)if(e[f].indexOf(this.opts.focusableClass)>-1){if(this.cardMap.hasOwnProperty(e[f]))continue;this.cardMap[e[f]]=a.filter("."+e[f])}};b.prototype={movement:function(b){var c=this.position(),d=this.opts.focusedClass,e=[],f=0;a(c.rows[c.x]).blur().removeClass(d),"LEFT"===b?(0===c.x&&(c.x=c.rows.length),f=--c.x,e=c.rows):"RIGHT"===b?(c.x===c.rows.length-1&&(c.x=-1),f=++c.x,e=c.rows):"UP"===b?(0===c.y&&(c.y=c.cols.length),f=--c.y,e=c.cols):"DOWN"===b&&(c.y===c.cols.length-1&&(c.y=-1),f=++c.y,e=c.cols),a(e[f]).focus().addClass(d);var g={x:++c.x,y:++c.y};return this.storage(g),g},storage:function(a){var b=window.sessionStorage;b?b[this.opts.focusableClass+"-point"]=JSON.stringify(a):console.log("Broswer does not support sessionStorage")},position:function(){for(var b=[],c=[],d=0,e=0,f="",g=this.opts.focusedClass,h=this.opts.focusableClass,i=this.cards.filter("."+g).attr("class").split(" "),j=0,k=i.length;k>j;j++)if(i[j].indexOf(h)>-1){f=i[j],b=this.cards.filter("."+f);break}for(var l in this.cardMap){if(f===l)break;e++}for(d=0,k=b.length;k>d&&!a(b[d]).hasClass(g);d++);for(var m in this.cardMap){var n=this.cardMap[m][d];"undefined"==typeof n&&(n=this.cardMap[m].last()),c.push(n)}var o={rows:b,cols:c,x:d,y:e};return o}};var c=function(c,d){this.opts=a.extend({customKeyEvent:{},focusedPoint:null,focusableClass:"focusable",focusedClass:"focused"},d),this.keys={LEFT:37,UP:38,RIGHT:39,DOWN:40},this.cards=a("[class*="+this.opts.focusableClass+"-row]"),this.arrow=new b(this.cards,this.opts),this.target=c,this.__constructor__()};c.prototype={__constructor__:function(){this.destroy();var b=this.opts.focusedPoint||{},c=window.sessionStorage;c&&(b.hasOwnProperty("x")||(b=c[this.opts.focusableClass+"-point"],b=a.parseJSON(b)||{x:1,y:1})),this.activeElement(b);var d=this.opts.tabindex||1;a(this.target).attr("tabindex",d)},activeElement:function(b){var c=this.opts.focusedClass;a("."+c).blur().removeClass(c);var d=[],e=0;b.y--;for(var f in this.arrow.cardMap){if(e===b.y){d=this.cards.filter("."+f);break}e++}(b.x>d.length||b.x<1)&&(b.x=1),a(d).eq(--b.x).focus().addClass(c)},addCustomKeyEvent:function(b){b=b||window.event;var c=this.opts.customKeyEvent;for(var d in c)d==(b.keyCode||b.which)&&a.isFunction(c[d])&&(c[d].call(this,b),b.preventDefault())},addCommonKeyEvent:function(b){var c=this.keys,d=this.opts.focusedClass,e=a("."+d);b=b||window.event;var f=b.which||b.keyCode;if(13===f&&a.isFunction(this.opts.enterFunc))this.opts.enterFunc.call(this,e,b),b.preventDefault();else if(8===f&&a.isFunction(this.opts.backFunc))this.opts.backFunc.call(this,e,b),b.preventDefault();else for(var g in c)if(f===c[g]){var h=this.arrow.movement(g);return a.isFunction(this.opts.callback)&&this.opts.callback.call(this,h,b),void b.preventDefault()}},destroy:function(){a(this.target).unbind("keydown"),a(this.target).find("."+this.opts.focusableClass).blur().removeClass(this.opts.focusedClass)}},jQuery.fn.arrowkeys=function(b){var d=this||document,e=new c(d,b);return a(d).keydown(function(a){e.addCommonKeyEvent(a),e.addCustomKeyEvent(a)}),a(d)}});